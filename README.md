# TRAFFIC QUERY
MySQL query available at traffic.py is designed to analyze network traffic data and summarize the types of network protocols used by each client, ordered by the amount of traffic they generate. Query is composed of a CTE (Common Table Expression) and a main query which makes use of the CTE. 

## CTE (Common Table Expression)
```bash
WITH traffic_cte AS (
    SELECT client, protocol, 
           (COALESCE(SUM(traffic_in),0) + COALESCE(SUM(traffic_out),0)) AS total_traffic 
    FROM happydata.traffic 
    GROUP BY client, protocol
)
```
- Purpose: The CTE traffic_cte calculates the total traffic (both incoming and outgoing) for each client and each protocol.
- Details:
  1. `client`: Represents the identifier of the client.
  2. `protocol`: The network protocol used by the client.
  3. `COALESCE(SUM(traffic_in), 0) + COALESCE(SUM(traffic_out), 0)`: This calculates the total traffic by summing up the incoming (traffic_in) and outgoing (traffic_out) traffic for each client-protocol pair. COALESCE ensures that if any traffic value is NULL, it is treated as 0.
  4. `GROUP BY client, protocol`: The traffic is grouped by both client and protocol to aggregate traffic for each unique combination.
## MAIN QUERY
```bash
SELECT client, 
       GROUP_CONCAT(protocol ORDER BY total_traffic DESC) AS protocol 
FROM traffic_cte 
GROUP BY client 
ORDER BY client ASC;
```
- Purpose: The main query further processes the results from traffic_cte to produce a summary for each client.
- Details:
  1. `client`: The identifier of the client.
  2. `GROUP_CONCAT(protocol ORDER BY total_traffic DESC) AS protocol`: This function concatenates the protocols used by each client into a single string, ordered by the amount of traffic generated by each protocol in descending order. This way, the protocol that generated the most traffic will appear first in the list.
  3. `GROUP BY client`: The results are grouped by client, so each row in the final result corresponds to one client.
  4. `ORDER BY client ASC`: The final results are sorted in ascending order by client.

## QUERY RESULTS

The query result shows a list of clients along with the protocols they have used, sorted in descending order of the total traffic associated with each protocol for that client. Clients are ordered in ascending order. The protocols for each client are grouped and listed as a comma-separated string. 
```bash
+-------------------+------------------------+
| client            | protocol               |
+-------------------+------------------------+
| 19-58-33-40-6E-66 | BGP,DNS,POP,SNP        |
| 9E-43-EA-54-0A-E7 | HTTPS,BGP,DNS,HTTP     |
| A6-B6-94-1E-07-FE | DHCP,TCP,HTTPS,DNS,BGP |
| BB-0B-0C-1D-24-F4 | IMAP,TCP,SNP,POP       |
| E4-00-CE-46-3F-26 | IMAP,DNS               |
+-------------------+------------------------+
5 rows in set (0.00 sec)
```